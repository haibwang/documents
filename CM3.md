- 影响实时性因素：是否使用实时嵌入式操作系统、中断延时、存储器延时、是否正在执行更高优先级的任务
- ARM处理器的命名：
  - ARM7TDMI：T-Thumb指令集，D-支持JTAG调试，M-快速乘法器，I-嵌入式ICE（在线仿真）模块
  - TDMI在后面的型号中，成为了标配，不在有了，加入了新的字符，定义了存储器接高速缓存、TCM紧耦合存储器
  - jazelle:ARM的硬件java加速器
- 指令系统：两套
  - 32位ARM态的ARM指令
  - 16位的Thumb态的Thumb指令，功能上是ARM指令的子集，但能带来更高的代码密度，给目标代码减肥
  - 两种状态可以动态切换

#### M3概览

- 特殊功能寄存器：

  -  程序状态寄存器xprs：存放状态标志、当前中断优先级

  - 中断屏蔽寄存器：PRIMASK、FAULTMASK、BASEPRI

  - 控制寄存器：CONTROL

      	

- 操作模式和特权级别

  -   处理者模式和线程模式
  - 特权级和用户级，处理者模式只能在特权级下执行
  - 特权级和用户级的切换，用户级只能触发异常进入处理者模式修改control进入特权级
  -  复位后进入特权级线程模式

- 中断

  - 中断一般指外部中断，异常一般指除外部中断外的所有异常

- 存储空间

  4GB：

- 总线接口

  - 指令存储区总线：I-CODE、D-CODE
  - 系统总线:访问内存和外设，包括sram、片上外设、片外ram、系统存储区的本分空间
  - 私有外设总线：调试组件



#### M3基础

- 寄存器组

- 堆栈指针MSP、PSP

- 连接寄存器

- 程序寄存器

- 特殊功能寄存器组

  - 程序状态寄存器xpsr
    - 应用程序PSR（APSR）
    - 中断号PSR（IPSR）
    - 执行PSR（EPSR）
  - 中断屏蔽寄存器：控制异常的使能和除能，对于时间关键任务，常常需要暂时关闭中断。**MSR\MRS**访问
    - PRIMASK：只有1位，当值位时，就关闭了所有可屏蔽中断，只剩下NMI和硬fault可以响应
    - FAULTMAK:只有1位，置位时，只有NMI可以响应。中断和硬fault关闭
    - BASEPRI:最多9位，由表达优先级的位数决定，当这只位0时，不关闭任何中断，当被设定某值时，优先级大于改值的中断将被关闭
    - 快速关中断指令CPS
      - CPSID   I  ；PRIMASK=1关中断
      - CPSIE   I   ;PRIMASK=0开中断
      - CPSID    F  ；FAULTMASK=1关异常
      - CPSIE     F ; FAULTMASK=0开异常
  - 控制寄存器CONTROL
    - 控制寄存器用于定义特权级别和使用的堆栈指针
    - CONTROL[0]控制特权级和用户级，handler下永远是特权级；只能在特权级下写
    - CONTROL[1]控制线程模式和处理者模式
    - 使用MSR\MRS指令访问

- 操作模式

  | 操作模式        | 用户级     | 特权级      |
  | --------------- | ---------- | ----------- |
  | 异常handler代码 | ---------- | handler模式 |
  | 应用程序代码    | 线程模式   | 线程模式    |

  

- 异常和中断

  - 11个系统异常、最多240个外部中断

- 向量表

  - 向量表就是32位数组，存放handler入口地址
  - 向量表的地址可以通过NVIC重定位寄存器设置
  - 复位后，向量表的地址在0，因此在地址0处必须有张向量表，用于初始时的异常分配

- 栈内存操作

  - 内核会在异常的始末自动调用PUSH和POP
  - CM3是向下生长的满栈，从栈内存的最后一个地址开始压栈

- 复位序列

  - 复位后，从0地址读取MSP的值；从0x4地址取PC的值





----

#### 指令集







---

#### 存储系统

- 概览

  - 存储映射预定义，哪个位置使用哪个总线
  - CM3支持位带操作（BIT_BAND），只存在一些特殊的寄存器区域
  - CM3支持非对齐访问和互斥访问
  - 支持both小端配置和大端配置

- 存储器映射

  - 线条划分

    | 地址段 | 存储器区域 |访问总线|
    | ------ | ---------- |------|
    | 512KB  | 私有外设   ||
    | 1GB    | 外部设备   ||
    | 1GB    | 外部ram    ||
    | 512KB  | 外设       ||
    | 512KB  | 片内ram    |系统总线|
    | 512KB  | 代码区     ||

- 存储器访问属性

  - 可否缓冲、可否缓存、可否执行、可否共享
  - 写回：写入的数据先逗留在缓存中，待有必有时在写入目的地
  - 写通：直接落实带目的地，不进过cache。与C中volatile有密切联系
  - 写时申请：

- 位带操作

  - 两个区域的低1M区域支持位带操作，每一个bit被膨胀为32位的字
  - 位带操作把原来的读-改-写操作改为了读地址-写数据操作，减少了两条指令，属于原子操作
  - C元位带操作
    - 定义位带地址的宏BIT_BAND(addr,bitnum)
    - 使用位带操作，要访问的变量必须申明为volatitle申明，是的每次操作都被如实执行而不被操作副本





---

#### CM整体风景

- 流水线
  - 三级流水线：取指令、解码、执行
  - 指令执行需要多个周期，流水线就会暂停下来
  - 执行跳转指令，需要清洗流水线
  - 